---
interface Props {
  placeholder?: string;
  targetSelector: string;
}

const { placeholder = 'Search...', targetSelector } = Astro.props;
---

<div class="relative max-w-md mx-auto mb-10 reveal">
  <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
    <svg class="w-5 h-5 text-(--color-text-secondary)" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
    </svg>
  </div>
  <input
    type="text"
    class="w-full pl-12 pr-4 py-3 rounded-xl border border-(--color-bg-secondary) bg-(--color-bg-primary) text-(--color-text-primary) placeholder:text-(--color-text-secondary)/60 focus:outline-none focus:ring-2 focus:ring-(--color-brand)/30 focus:border-(--color-brand) transition-all"
    placeholder={placeholder}
    data-search-input
    data-search-target={targetSelector}
  />
  <p class="hidden mt-4 text-center text-(--color-text-secondary) text-sm" data-search-empty>
    No results found. Try a different search term.
  </p>
</div>

<script>
  document.querySelectorAll<HTMLInputElement>('[data-search-input]').forEach((input) => {
    const targetSelector = input.dataset.searchTarget;
    if (!targetSelector) return;

    const container = input.closest('section') || document;
    const emptyMsg = input.parentElement?.querySelector('[data-search-empty]');

    input.addEventListener('input', () => {
      const query = input.value.toLowerCase().trim();
      const cards = container.querySelectorAll(targetSelector);
      let visibleCount = 0;

      cards.forEach((card) => {
        const searchText = (card as HTMLElement).dataset.search?.toLowerCase() || card.textContent?.toLowerCase() || '';
        const matches = !query || searchText.includes(query);
        (card as HTMLElement).style.display = matches ? '' : 'none';
        if (matches) visibleCount++;
      });

      if (emptyMsg) {
        emptyMsg.classList.toggle('hidden', visibleCount > 0);
      }
    });
  });
</script>
